---
import BaseLayout from "@layouts/BaseLayout.astro";
import type { ImageMetadata } from "astro";
import HolidayCourseList from "./_components/HolidayCourseList.astro";
import HolidayDiscountBundle from "./_components/HolidayDiscountBundle.astro";
import HolidayHero from "./_components/HolidayHero.astro";
import type { HolidayCategory } from "./_types/holidayCategory.ts";

interface Props {
  annotation: string;
  bundleImage: ImageMetadata;
  categories: HolidayCategory[];
  description: string;
  forcedTheme: string;
  logoSuffix: string;
  subtitle1: string;
  subtitle2: string;
  title: string;
}

const {
  annotation,
  bundleImage,
  categories,
  description,
  forcedTheme,
  logoSuffix,
  subtitle1,
  subtitle2,
  title,
} = Astro.props;

const prices = categories
  .flatMap(({ courses }) => courses)
  .map(({ prices }) => prices)
  .reduce(
    (acc, element) => ({
      old: acc.old + element.old,
      new: acc.new,
    }),
    { old: 0, new: 395 },
  );
const couponCode = "BLACK_FRIDAY_2024";
const pricingPlanId = 5951531;
const slug = "black-friday-2024";
---

<BaseLayout {description} {forcedTheme} {title}>
  <HolidayHero {annotation} {logoSuffix} {subtitle1} {subtitle2} {title} />
  <HolidayDiscountBundle
    {bundleImage}
    offer={`... you get a one-time "everything" offer. Everything currently
              published ($${prices.old} worth of courses), at an unbeatable price.`}
    {pricingPlanId}
    {slug}
    {prices}
    {title}
  />
  <HolidayCourseList {categories} {couponCode} />
</BaseLayout>
